"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.encodeURIQueryValue=exports.querystring=exports.compareArrays=exports.validateSearchParams=exports.randInt=exports.shuffle=exports.tryParseJSON=exports.jsonfy=exports.resolveSite=void 0;const Constants_1=require("./Constants"),fast_xml_parser_1=require("fast-xml-parser");function resolveSite(r){if("string"!=typeof r)return null;r=r.toLowerCase();for(const[e,t]of Object.entries(Constants_1.sites))if(e===r||t.domain===r||t.aliases.includes(r))return e;return null}exports.resolveSite=resolveSite;const xmlParser=new fast_xml_parser_1.XMLParser({ignoreAttributes:!1,attributeNamePrefix:""});function jsonfy(r){if("object"==typeof r)return r;const e=xmlParser.parse(r);if(e.html||e["!doctype"]){const r=e.html||e["!doctype"]?.html,t=[];throw r.body.h1&&t.push(r.body.h1),r.body.p&&t.push(r.body.p["#text"]),new Constants_1.BooruError(`The Booru sent back an error: '${t.join(": ")}'`)}return e.posts.post?e.posts.post:e.posts.tag?Array.isArray(e.posts.tag)?e.posts.tag:[e.posts.tag]:[]}function tryParseJSON(r){return""===r?[]:JSON.parse(r)}function shuffle(r){let e,t,o=r.length;for(;0!==o;)t=Math.floor(Math.random()*o),o-=1,e=r[o],r[o]=r[t],r[t]=e;return r}function randInt(r,e){return r=Math.ceil(r),e=Math.floor(e),Math.floor(Math.random()*(e-r+1))+r}function validateSearchParams(r,e){const t=resolveSite(r);if("number"!=typeof e&&(e=parseInt(e,10)),null===t)throw new Constants_1.BooruError("Site not supported");if("number"!=typeof e||Number.isNaN(e))throw new Constants_1.BooruError("`limit` should be an int");return{site:t,limit:e}}function compareArrays(r,e){return r.filter((r=>e.some((e=>r.toLowerCase()===e.toLowerCase()))))}function querystring(r,{arrayJoin:e="+"}={}){return Object.entries(r).map((([r,t])=>`${encodeURIComponent(r)}=${encodeURIQueryValue(t,{arrayJoin:e})}`)).join("&")}function encodeURIQueryValue(r,{arrayJoin:e="+"}={}){return Array.isArray(r)?r.map(encodeURIComponent).join(e):encodeURIComponent(r)}exports.jsonfy=jsonfy,exports.tryParseJSON=tryParseJSON,exports.shuffle=shuffle,exports.randInt=randInt,exports.validateSearchParams=validateSearchParams,exports.compareArrays=compareArrays,exports.querystring=querystring,exports.encodeURIQueryValue=encodeURIQueryValue;